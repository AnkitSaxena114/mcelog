.\" disk db commented out for now because it's not usable enough
.TH MCELOG 8 "May 2009" "SuSE Labs" "Linux's Administrator's Manual"
.SH NAME
mcelog \- Print machine check log from x86-64 kernel.
.SH SYNOPSIS
mcelog [options] [device]
.br
mcelog [options] \-\-ascii
.br
.\"mcelog [options] \-\-drop-old-memory
.\".br
.\"mcelog [options] \-\-reset-memory locator
.\".br
.\"mcelog [options] \-\-dump-memory[=locator]
.br
mcelog \-\-version
.SH DESCRIPTION
Linux x86-64 kernels since 2.6.4 don't print recoverable machine check errors
to the kernel log anymore. Instead they are saved into a special 
kernel buffer accessible using
.I /dev/mcelog.
mcelog reads /dev/mcelog and prints the stored machine check records
to stdout. Then the stored machine check records in the kernel
buffer are deleted.

Mcelog normally runs as a regular cron job to log kernel machine check
events to disk. On newer kernels it can also be triggered directly
using the 
.I /sys/devices/system/machinecheck/machinecheck0/trigger
trigger.
In addition mcelog can be used on the command line to decode an existing machine 
check record in ascii format with the 
.I \-\-ascii
option. This is typically used to decode the panic console output of a fatal
machine check, if mcelog was unable to log the data after a warm reboot.

When the 
.B \-\-syslog
option is specified redirect output to system log. The 
.B \-\-syslog-error
option causes the normal machine checks to be logged as 
.I LOG_ERR
(implies
.I \-\-syslog
). Normally only fatal errors or high level remarks are logged with error level.
Some one line summies of errors are also always logged to the syslog by
default unless mcelog operates in 
.I \-\-ascii 
mode.

When the
.B \-\-logfile=file
option is specified append log output to the specified file. With the
.B \-\-no-syslog
option mcelog will never log anything to the syslog.

When the
.B \-\-cpu=cputype
option is specified set the to be decoded CPU to 
.I cputype. 
See 
.I mcelog \-\-help
for a list of valid CPUs.
Note that specifying an incorrect CPU can lead to incorrect decoding output.
Default is either the CPU of the machine that reported the machine check (needs
a newer kernel version) or the CPU of the machine mcelog is running on, so normally
this option doesn't have to be used. Older versions of mcelog had separate
options for different CPU types. These are still implemented, but deprecated
and undocumented now.

With the
.B \-\-dmi
option mcelog will look up the addresses reported in machine
checks in the 
.I SMBIOS/DMI
tables of the BIOS.
This can sometimes tell you which DIMM or memory controller
has developed a problem. More often the information reported
by the BIOS is either subtly or obviously wrong or useless.
This option requires that mcelog has read access to /dev/mem
(normally requires root) and runs on the same machine
in the same hardware configuration as when the machine check
event happened.

When 
.B \-\-ignorenodev
is specified then mcelog will exit silently when the device
cannot be opened. This is useful in virtualized environment
with limited devices.

When 
.B \-\-filter
is specified 
.I mcelog
will filter out known broken machine check events (default on). When the 
.B \-\-no-filter
option is specified mcelog does not filter events.

When 
.B \-\-raw
is specified
.I mcelog
will not decode, but just dump the mcelog in a raw hex format. This
can be useful for automatic post processing.

When a device is specified the machine check logs are read from
device instead of the default
.I /dev/mcelog.

With the 
.B \-\-ascii
option mcelog decodes a fatal machine check panic generated
by the kernel ("CPU n: Machine Check Exception ...") in ASCII from standard input
and exits afterwards.
Note that when the panic comes from a different machine than 
where mcelog is running on you might need to specify the correct
cputype on older kernels. On newer kernels which output the 
.I PROCESSOR
field this is not needed anymore.

When the 
.B \-\-file filename
option is specified 
.I mcelog \-\-ascii
will read the ASCII machine check record from input file 
.I filename
instead of standard input.

With the
.B \-\-config-file file
option mcelog reads the specified config file.
Default is 
.I /etc/mcelog.conf
See also 
.I CONFIG FILE
below.

With the
.B \-\-daemon
option mcelog will run in the background and continuously poll
for machine checks for the kernel. This gives the fastest reaction
time, but the normal recommended operating mode is running
as a cronjob or from the kernel trigger (through
.I /sys/devices/system/machinecheck/machinecheck0/trigger). 
This option implies 
.I \-\-syslog.

With the
.B \-\-cpumhz=mhz
option assume the CPU has 
.I mhz
frequency for decoding the time of the event using the CPU time stamp
counter. This also forces decoding. Note this can be unreliable.
on some systems with CPU frequency scaling or deep C states, where
the CPU time stamp counter does not increase linearly.
By default the frequency of the current CPU is used when mcelog
determines it is safe to use. Newer kernels report
the time directly in the event and don't need this anymore.

.\".B \-\-database filename
.\"specifies the memory module error database file. Default is
.\"/var/lib/memory-errors.  It is only used together with DMI decoding.
.\"
.\"
.\".B \-\-error\-trigger=cmd,thresh
.\"When a memory module accumulates 
.\".I thresh
.\"errors in the err database run command 
.\".I cmd. 
.\"
.\".B \-\-drop-old-memory
.\"Drop old DIMMs in the memory module database that are not plugged in
.\"anymore.
.\"
.\".B \-\-reset\-memory=locator
.\"When the DIMMs have suitable unique serial numbers mcelog
.\"will automatically detect changed DIMMs. When the DIMMs don't
.\"have those the user will have to use this option when changing
.\"a DIMM to reset the error count in the error database.
.\".I Locator 
.\"is the memory slot identifier printed on the motherboard.
.\"
.\".B \-\-dump-memory[=locator]
.\"Dump error database information for memory module located
.\"at 
.\".I locator.
.\"When no locator is specified dump all.

.B \-\-version
displays the version of mcelog and exits.

.SH CONFIG FILE
mcelog supports a config file to set defaults. Command line options override
the config file. By default the config file is read from
.I /etc/mcelog.conf
unless overriden with the 
.I --config-file
option.

The general format is
.I optionname = value
White space is not allowed in value currently, except at the end where it is dropped
Comments start with #.

All command line options that are not commands can be specified in the config file.
For example t to enable the 
.I --no-syslog
option use 
.I no-syslog = yes   
(or no to disable).  When the option has a argument
use
.I logfile = /tmp/logfile

.SH NOTES
The kernel prefers old messages over new. If the log buffer overflows
only old ones will be kept.

The exact output depends on the CPU.

SMBIOS/DMI output is unreliable and sometimes wrong. Not Linux's
fault - complain to your motherboard vendor. mcelog does some sanity
checks to distingush bad BIOS from good BIOS but it is not 100% 
fool proof.

mcelog will report serious errors to the syslog during decoding.

.SH FILES
/dev/mcelog (char 10, minor 227) 
.br
/etc/mcelog.conf
.br
/var/lib/memory-errors
.br
Memory error database
.SH SEE ALSO
AMD x86-64 architecture programmer's manual, Volume 2, System programming
.br
IA32 Intel Architecture Software developer's manual, Volume 3, System programming guide
.br
Datasheet of your CPU.
