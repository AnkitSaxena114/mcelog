#!/bin/bash

awk -F\| 'BEGIN {
	print "/* Do not edit. Autogenerated from cputype.table */" > "cputype.tmp"
	print "enum cputype {" > "cputype.tmp"
	print "\tCPU_GENERIC," > "cputype.tmp"
	print "\tCPU_K8," > "cputype.tmp"
	print "\tCPU_INTEL," > "cputype.tmp"
	print "\tCPU_P4," > "cputype.tmp"
	print "\tCPU_TULSA," > "cputype.tmp"

	print "/* Do not edit. Autogenerated from cputype.table */" > "lookup_intel_cputype.tmp"
	print "#include \"cputype.h\"\n" > "lookup_intel_cputype.tmp"
	print "enum cputype lookup_intel_cputype(int model)" > "lookup_intel_cputype.tmp"
	print "{" > "lookup_intel_cputype.tmp"
	print "\tswitch (model) {" > "lookup_intel_cputype.tmp"
}
{
	printf("\t%s,\n", $1) > "cputype.tmp"

	n = split($2, model, ",")
	for (i = 1; i <= n; i++)
		printf("\tcase %s:\n", model[i]) > "lookup_intel_cputype.tmp"
	printf("\t\treturn %s;\n", $1) > "lookup_intel_cputype.tmp"

}
END {
	printf("};\n") > "cputype.tmp"
	printf "enum cputype lookup_intel_cputype(int model);" > "cputype.tmp"

	print "\tdefault: return -1;" > "lookup_intel_cputype.tmp"
	print "\t}\n}" > "lookup_intel_cputype.tmp"
}' cputype.table
